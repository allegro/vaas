{% spaceless %}
<div id="conditions-container" class="row">
    <div class="condition-item row mb-2">
    {% for widget in widget.widgets %}
        {% include widget.template_name %}
    {% endfor %}
    </div>
</div>
<div class="row mt-3">
    <div class="col-auto">
        <button type="button" class="btn btn-danger" id="del_condition">-</button>
    </div>
    <div class="col-auto">
        <button type="button" class="btn btn-primary" id="add_condition">+</button>
    </div>
</div>
{% endspaceless %}

{% block extrajs %}
<script>
    (function ($) {
        let conditionCounter = $('#conditions-container .condition-item').length;
        function addCondition() {
            conditionCounter++;
            $.ajax({
                url: '/router/add_condition/',
                type: 'GET',
                success: function (response) {
                    const conjunctionRow = $(`
                <div class="row mb-2" id="conjunction_${conditionCounter}">
                    <div class="col text-center"><strong>AND</strong></div>
                </div>
            `);
                    $('#conditions-container')
                        .append(conjunctionRow)
                        .append(response);
                }
            });
        }

        $('#add_condition').on('click', addCondition);


        function delCondition() {
            if (conditionCounter <= 1) {
                return
            }
            const lastCondition = $('#conditions-container .condition-item').last();
            const lastConjunction = $('#conditions-container .row[id^="conjunction_"]').last();
            lastConjunction.remove();
            lastCondition.remove();
            conditionCounter--;
        }
        $('#del_condition').on('click', delCondition);
    })(django.jQuery);
</script>
{% endblock %}